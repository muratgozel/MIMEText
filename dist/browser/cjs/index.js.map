{"version":3,"file":"index.js","sources":["../../../src/MIMETextError.js","../../../src/MIMEMessageHeader.js","../../../src/MIMEMessageContent.js","../../../src/Mailbox.js","../../../src/MIMEMessage.js","../../../src/entrypoints/browser.js"],"sourcesContent":["export default class MIMETextError extends Error {\n  constructor(message, description) {\n    super(message)\n    this.description = description ? description.trim().replace(/[\\s]{2,}/, ' ') : null\n    this.name = 'MIMETextError'\n  }\n}\n","import MIMETextError from './MIMETextError.js'\n\n/*\n* Headers are based on: https://www.rfc-editor.org/rfc/rfc4021#section-2.1\n* (Some are ignored as they can be added later or as a custom header.)\n*/\n\nexport default class MIMEMessageHeader {\n  constructor(placement) {\n    this.placement = placement\n    this.store = [\n      {\n        placement: 'header',\n        name: 'Date',\n        // value property is what user sets for this header\n        value: null,\n        // the generator function generates a value for this header unless\n        // user specified a value or user disabled this property\n        generator: () => (new Date().toGMTString()).replace(/GMT|UTC/gi, '+0000'),\n        disabled: false,\n        dump: (v) => {\n          return v\n        }\n      },\n      {\n        placement: 'header',\n        name: 'From',\n        // required property indicates that this property must be set\n        required: true,\n        dump: (v) => {\n          return v.dump()\n        }\n      },\n      {\n        placement: 'header',\n        name: 'Sender',\n        dump: (v) => {\n          return v.dump()\n        }\n      },\n      {\n        placement: 'header',\n        name: 'Reply-To',\n        dump: (v) => {\n          return v\n        }\n      },\n      {\n        placement: 'header',\n        name: 'To',\n        required: true,\n        dump: (vs) => {\n          return vs.map(v => v.dump()).join(', ')\n        }\n      },\n      {\n        placement: 'header',\n        name: 'Cc',\n        dump: (vs) => {\n          return vs.map(v => v.dump()).join(', ')\n        }\n      },\n      {\n        placement: 'header',\n        name: 'Bcc',\n        dump: (vs) => {\n          return vs.map(v => v.dump()).join(', ')\n        }\n      },\n      {\n        placement: 'header',\n        name: 'Message-ID',\n        disabled: false,\n        generator: (ctx) => {\n          const datestr = Date.now().toString()\n          const randomstr = Math.random().toString(36).slice(2)\n          const domain = ctx.store.filter(item => item.name == 'From')[0].value.getAddrDomain()\n          return '<' + randomstr + '-' + datestr + '@' + domain + '>'\n        },\n        dump: (v) => {\n          return v\n        }\n      },\n      {\n        placement: 'header',\n        name: 'Subject',\n        required: true,\n        dump: (v, ctx) => {\n          return '=?utf-8?B?' + ctx.toBase64(v) + '?='\n        }\n      },\n      {\n        placement: 'header',\n        name: 'MIME-Version',\n        generator: () => '1.0',\n        dump: (v) => {\n          return v\n        }\n      },\n      {\n        placement: 'content',\n        name: 'Content-ID',\n        dump: (v) => {\n          return v\n        }\n      },\n      {\n        placement: 'content',\n        name: 'Content-Type',\n        dump: (v) => {\n          return v\n        }\n      },\n      {\n        placement: 'content',\n        name: 'Content-Transfer-Encoding',\n        dump: (v) => {\n          return v\n        }\n      },\n      {\n        placement: 'content',\n        name: 'Content-Disposition',\n        dump: (v) => {\n          return v\n        }\n      }\n    ]\n  }\n\n  set(name, value) {\n    for (const item of this.store) {\n      if (item.name.toLowerCase() == name.toLowerCase()) {\n        item.value = value\n        return item\n      }\n    }\n\n    const newHeader = {\n      custom: true,\n      placement: this.placement,\n      name: name,\n      value: value,\n      dump: (v) => {\n        return v\n      }\n    }\n\n    this.store.push(newHeader)\n\n    return newHeader\n  }\n\n  get(name) {\n    for (const item of this.store) {\n      if (item.name.toLowerCase() == name.toLowerCase()) {\n        return item.value\n      }\n    }\n    return undefined\n  }\n\n  toObject() {\n    return this.store.reduce((memo, item) => {\n      memo[item.name] = item.value\n      return memo\n    }, {})\n  }\n\n  dump(envctx) {\n    const ctx = {\n      toBase64: envctx.toBase64,\n      store: this.store\n    }\n\n    let lines = ''\n    for (const item of this.store) {\n      if (item.placement != this.placement) continue;\n\n      const v = item.value\n        ? item.value\n        : !item.disabled && typeof item.generator == 'function'\n          ? item.generator(ctx)\n          : null\n\n      if (!v && item.required) {\n        throw new MIMETextError('MISSING_HEADER', `The \"${item.name}\" header is required.`)\n      }\n\n      if (!v) continue;\n\n      lines += `${item.name}: ${item.dump(v, ctx)}\\r\\n`\n    }\n\n    return lines.slice(0, -2)\n  }\n}\n","import MIMEMessageHeader from './MIMEMessageHeader.js'\n\nexport default class MIMEMessageContent {\n  constructor(data) {\n    this.data = data\n    this.headers = new MIMEMessageHeader('content')\n  }\n\n  setHeader() {\n    this.headers.set(arguments[0], arguments[1])\n    return this\n  }\n\n  setHeaders(obj) {\n    Object.keys(obj).map(prop => this.setHeader(prop, obj[prop]))\n    return this\n  }\n\n  getHeaders() {\n    return this.headers.toObject()\n  }\n\n  getHeader(name) {\n    return this.headers.get(name)\n  }\n\n  isAttachment() {\n    const d = this.headers.get('Content-Disposition')\n    return d && d.indexOf('attachment') !== -1 ? true : false\n  }\n\n  dump(envctx, boundaries) {\n    const headerBlock = this.headers.dump(envctx)\n\n    if (this.isAttachment()) {\n      return `--${boundaries.mixed}\n${headerBlock}\n\n${this.data}\n`\n    }\n    else {\n      return `${headerBlock}\\r\\n\\r\\n${this.data}`\n    }\n  }\n}\n","import MIMETextError from './MIMETextError.js'\n\nexport default class Mailbox {\n  constructor(input, opts={type: 'to'}) {\n    this.reSpecCompliantAddr = /(([^<>\\n\\r]+)\\s)?<[^\\n\\r]+>/\n\n    this.name = null\n    this.addr = null\n    this.type = opts.type || 'to'\n    this.input = input\n    this.inputType = this.findInputType(input)\n\n    this.createMailbox()\n  }\n\n  findInputType(input) {\n    if (Object.prototype.toString.call(input) === '[object Object]') {\n      if (!input.addr) {\n        throw new MIMETextError('INVALID_MAILBOX', `\n          The input should have an \"addr\" property that specifies the email address \\\n          of the recipient.\n        `)\n      }\n      return 'OBJECT'\n    }\n    else if (this.reSpecCompliantAddr.test(input)) {\n      return 'SPEC_COMPLIANT_TEXT'\n    }\n    else if (typeof input == 'string') {\n      return 'TEXT'\n    }\n    else {\n      throw new MIMETextError('INVALID_MAILBOX')\n    }\n  }\n\n  parseSpecCompliantText(text) {\n    text.trim()\n\n    if (text.slice(0, 1) == '<' && text.slice(-1) == '>') {\n      return {addr: text.slice(1, -1)}\n    }\n\n    const arr = text.split(' <')\n    arr[0] = /^(\"|')/.test(arr[0]) ? arr[0].slice(1) : arr[0]\n    arr[0] = /(\"|')$/.test(arr[0]) ? arr[0].slice(0, -1) : arr[0]\n    arr[1] = arr[1].slice(0, -1)\n\n    return {name: arr[0], addr: arr[1]}\n  }\n\n  createMailbox() {\n    switch (this.inputType) {\n      case 'OBJECT':\n        this.addr = this.input.addr\n        this.name = this.input.name || null\n        this.type = this.input.type || this.type\n        break;\n\n      case 'SPEC_COMPLIANT_TEXT':\n        const obj = this.parseSpecCompliantText(this.input)\n        this.addr = obj.addr\n        this.name = obj.name || null\n        break;\n\n      case 'TEXT':\n        this.addr = this.input\n        break;\n\n      default:\n        break;\n    }\n  }\n\n  getAddrDomain() {\n    if (!this.addr) {\n      return ''\n    }\n\n    return this.addr.split('@')[1]\n  }\n\n  dump() {\n    let result = `<${this.addr}>`\n\n    if (this.name) {\n      result = `\"${this.name}\" ${result}`\n    }\n\n    return result\n  }\n\n  toObject() {\n    return {\n      name: this.name,\n      addr: this.addr,\n      type: this.type\n    }\n  }\n}\n","import MIMEMessageHeader from './MIMEMessageHeader.js'\nimport MIMEMessageContent from './MIMEMessageContent.js'\nimport MIMETextError from './MIMETextError.js'\nimport Mailbox from './Mailbox.js'\n\nexport default class MIMEMessage {\n  constructor(envctx) {\n    this.envctx = envctx\n    this.headers = new MIMEMessageHeader('header')\n    this.messages = []\n\n    this.generateBoundaries()\n  }\n\n  generateBoundaries() {\n    this.boundaries = {\n      mixed: Math.random().toString(36).slice(2),\n      alt: Math.random().toString(36).slice(2)\n    }\n  }\n\n  setSender(input) {\n    const mailbox = new Mailbox(input, {type: 'from'})\n\n    this.setHeader('From', mailbox)\n\n    return mailbox\n  }\n\n  getSender() {\n    return this.getHeader('From')\n  }\n\n  setRecipients(input, opts={type: 'to'}) {\n    const recs = []\n\n    if (Array.isArray(input)) {\n      input.map(input => recs.push( new Mailbox(input, opts) ))\n    }\n    else {\n      recs.push( new Mailbox(input, opts) )\n    }\n\n    this.setHeader(opts.type, recs)\n\n    return recs\n  }\n\n  getRecipients(opts={type: 'to'}) {\n    return this.getHeader(opts.type) || []\n  }\n\n  setRecipient(input) {\n    return this.setRecipients(input, {type: 'to'})\n  }\n\n  setTo(input) {\n    return this.setRecipients(input, {type: 'to'})\n  }\n\n  setCc(input) {\n    return this.setRecipients(input, {type: 'cc'})\n  }\n\n  setBcc(input) {\n    return this.setRecipients(input, {type: 'bcc'})\n  }\n\n  setSubject(value) {\n    this.setHeader('subject', value)\n    return value\n  }\n\n  getSubject() {\n    return this.getHeader('subject')\n  }\n\n  setHeader() {\n    this.headers.set(arguments[0], arguments[1])\n    return arguments[0]\n  }\n\n  getHeader(name) {\n    return this.headers.get(name)\n  }\n\n  setHeaders(obj) {\n    Object.keys(obj).map(prop => this.setHeader(prop, obj[prop]))\n    return this\n  }\n\n  getHeaders() {\n    return this.headers.toObject()\n  }\n\n  setMessage(type, data, moreHeaders={}) {\n    const validTypes = ['text/html', 'text/plain', 'text/x-amp-html']\n\n    if (validTypes.indexOf(type) === -1) {\n      throw new MIMETextError('INVALID_MESSAGE_TYPE', `\n        Invalid content type for the message. Supported content types \\\n        are ${validTypes.join(', ')} but you specified \"${type}\".\n      `)\n    }\n\n    const headers = Object.assign({}, moreHeaders, {\n      'Content-Type': `${type}; charset=UTF-8`\n    })\n    const msg = new MIMEMessageContent(data)\n\n    msg.setHeaders(headers)\n\n    this.messages.push(msg)\n\n    return msg\n  }\n\n  setAttachment(filename, type, data, moreHeaders={}) {\n    const headers = Object.assign({}, moreHeaders, {\n      'Content-Type': `${type}; charset=UTF-8`,\n      'Content-Transfer-Encoding': 'base64',\n      'Content-Disposition': `attachment;filename=\"${filename}\"`\n    })\n    const msg = new MIMEMessageContent(data)\n\n    msg.setHeaders(headers)\n\n    this.messages.push(msg)\n\n    return this\n  }\n\n  getMessageByType(type) {\n    const matches = this.messages.filter(m => m.getHeader('Content-Type').indexOf(type) !== -1)\n    if (Array.isArray(matches) && matches.length > 0) {\n      return matches[0]\n    }\n    else {\n      return undefined\n    }\n  }\n\n  getAttachments() {\n    return this.messages.filter(m => m.isAttachment() === true) || []\n  }\n\n  asRaw() {\n    let lines = this.headers.dump(this.envctx)\n\n    const plainTextMessage = this.getMessageByType('text/plain')\n    const htmlMessage = this.getMessageByType('text/html')\n    const ampMessage = this.getMessageByType('text/x-amp-html')\n    const hasAttachments = this.getAttachments().length > 0\n    const hasPlainTextAlt = plainTextMessage instanceof MIMEMessageContent && htmlMessage instanceof MIMEMessageContent\n    const hasAmpAlt = plainTextMessage instanceof MIMEMessageContent && htmlMessage instanceof MIMEMessageContent && ampMessage instanceof MIMEMessageContent\n\n    if (hasAttachments && hasPlainTextAlt) {\n      return this.asRawMixedAlt(lines)\n    }\n    else if (hasAttachments) {\n      return this.asRawMixed(lines)\n    }\n    else if(hasAmpAlt) {\n      return this.asRawAmp(lines)\n    }\n    else if (hasPlainTextAlt) {\n      return this.asRawAlt(lines)\n    }\n    else {\n      return this.asRawMessage(lines)\n    }\n  }\n\n  asEncoded() {\n    return this.envctx.toBase64WebSafe( this.asRaw() )\n  }\n\n  asRawMessage(lines) {\n    const plainTextMessage = this.getMessageByType('text/plain')\n    const htmlMessage = this.getMessageByType('text/html')\n    const message = htmlMessage || plainTextMessage\n\n    lines = `${lines}\n${message.dump(this.envctx, this.boundaries)}`\n\n    return lines\n  }\n\n  asRawAlt(lines) {\n    const plainTextMessage = this.getMessageByType('text/plain')\n    const htmlMessage = this.getMessageByType('text/html')\n\n    lines = `${lines}\nContent-Type: multipart/alternative; boundary=${this.boundaries.alt}\n\n--${this.boundaries.alt}\n${plainTextMessage.dump(this.envctx, this.boundaries)}\n\n--${this.boundaries.alt}\n${htmlMessage.dump(this.envctx, this.boundaries)}\n\n--${this.boundaries.alt}--`\n\n    return lines\n  }\n\n  asRawAmp(lines) {\n    const plainTextMessage = this.getMessageByType('text/plain')\n    const htmlMessage = this.getMessageByType('text/html')\n    const ampMessage = this.getMessageByType('text/x-amp-html')\n\n    lines = `${lines}\nContent-Type: multipart/alternative; boundary=${this.boundaries.alt}\n\n--${this.boundaries.alt}\n${plainTextMessage.dump(this.envctx, this.boundaries)}\n\n--${this.boundaries.alt}\n${ampMessage.dump(this.envctx, this.boundaries)}\n\n--${this.boundaries.alt}\n${htmlMessage.dump(this.envctx, this.boundaries)}\n\n--${this.boundaries.alt}--`\n\n    return lines\n  }\n\n  asRawMixed(lines) {\n    const plainTextMessage = this.getMessageByType('text/plain')\n    const htmlMessage = this.getMessageByType('text/html')\n    const message = htmlMessage || plainTextMessage\n    const attachments = this.getAttachments()\n      .map(a => a.dump(this.envctx, this.boundaries))\n      .join('')\n      .replace(/[\\r\\n]$/g, '')\n\n    lines = `${lines}\nContent-Type: multipart/mixed; boundary=${this.boundaries.mixed}\n\n--${this.boundaries.mixed}\n${message.dump(this.envctx, this.boundaries)}\n\n${attachments}\n\n--${this.boundaries.mixed}--`\n\n    return lines\n  }\n\n  asRawMixedAlt(lines) {\n    const plainTextMessage = this.getMessageByType('text/plain')\n    const htmlMessage = this.getMessageByType('text/html')\n    const attachments = this.getAttachments()\n      .map(a => a.dump(this.envctx, this.boundaries))\n      .join('')\n      .replace(/[\\r\\n]$/g, '')\n\n    lines = `${lines}\nContent-Type: multipart/mixed; boundary=${this.boundaries.mixed}\n\n--${this.boundaries.mixed}\nContent-Type: multipart/alternative; boundary=${this.boundaries.alt}\n\n--${this.boundaries.alt}\n${plainTextMessage.dump(this.envctx, this.boundaries)}\n\n--${this.boundaries.alt}\n${htmlMessage.dump(this.envctx, this.boundaries)}\n\n--${this.boundaries.alt}--\n${attachments}\n\n--${this.boundaries.mixed}--`\n\n    return lines\n  }\n\n  toBase64(v) {\n    return this.envctx.toBase64(v)\n  }\n}\n","import MIMEMessage from '../MIMEMessage.js'\n\nconst envctx = {\n  toBase64: function toBase64(data) {\n    return btoa(data)\n  },\n  toBase64WebSafe: function toBase64WebSafe(data) {\n    return btoa(data)\n      .replace(/\\+/g, '-')\n      .replace(/\\//g, '_')\n      .replace(/=+$/, '')\n  }\n}\n\nclass NodeMIMEMessage extends MIMEMessage {\n  constructor() {\n    super(envctx)\n  }\n}\n\nexport function createMimeMessage() {\n  return new NodeMIMEMessage()\n}\n"],"names":["MIMETextError","message","description","_trimInstanceProperty","replace","name","Error","MIMEMessageHeader","placement","store","value","generator","Date","toGMTString","disabled","dump","v","required","vs","_mapInstanceProperty","join","ctx","datestr","now","toString","randomstr","_sliceInstanceProperty","Math","random","domain","_filterInstanceProperty","item","getAddrDomain","toBase64","toLowerCase","newHeader","custom","push","undefined","_reduceInstanceProperty","memo","envctx","lines","MIMEMessageContent","data","headers","set","arguments","obj","prop","setHeader","toObject","get","d","_indexOfInstanceProperty","boundaries","headerBlock","isAttachment","mixed","Mailbox","input","opts","type","reSpecCompliantAddr","addr","inputType","findInputType","createMailbox","Object","prototype","call","test","text","arr","split","parseSpecCompliantText","result","MIMEMessage","messages","generateBoundaries","alt","mailbox","getHeader","recs","Array","isArray","setRecipients","moreHeaders","validTypes","_Object$assign","msg","setHeaders","filename","matches","m","length","plainTextMessage","getMessageByType","htmlMessage","ampMessage","hasAttachments","getAttachments","hasPlainTextAlt","hasAmpAlt","asRawMixedAlt","asRawMixed","asRawAmp","asRawAlt","asRawMessage","toBase64WebSafe","asRaw","attachments","a","btoa","NodeMIMEMessage","createMimeMessage"],"mappings":"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"}